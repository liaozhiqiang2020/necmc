<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header::header-css">
    <title>销售报表</title>
</head>

<style>



    .login-button { /* 按钮美化 */
        width: 70px; /* 宽度 */
        height: 28px; /* 高度 */
        border-width: 0px; /* 边框宽度 */
        border-radius: 3px; /* 边框半径 */
        background: #1E90FF; /* 背景颜色 */
        cursor: pointer; /* 鼠标移入按钮范围时出现手势 */
        outline: none; /* 不显示轮廓线 */
        font-family: Microsoft YaHei; /* 设置字体 */
        color: white; /* 字体颜色 */
        font-size: 17px; /* 字体大小 */
    }
    .login-button:hover { /* 鼠标移入按钮范围时改变颜色 */
        background: #5599FF;
    }









</style>
<body class="hold-transition skin-blue sidebar-mini">
<div th:replace="fragments/header::header-body"/>

<div class="content-wrapper">

    <section  class="content-header">
        <h1>
            销售报表
        </h1>
        <ol class="breadcrumb">
            <li><a href="/mc/index"><i class="fa fa-dashboard"></i>首页</a></li>
            <li class="active">销售报表</li>
        </ol>
    </section>

    <div class="container-fluid">
        <div id="example" >


            <div class="demo-section k-content">

                <div id="fieldlist" style="background-color:#EDF0F4">
                    <h5>起始日期:   <input id="start" style="width: 270px;" value="起始日期" /></h5>
                        <h5>截至日期:   <input id="end" style="width: 270px;" value="截至日期"/></h5>
                    <h5>省份:  <input id="province" />
                    城市:   <input id="city" />
                    场地:   <input id="place" /> <!--下拉框-->
                    <button class="login-button" onclick="grid()">查询</button></h5>
                </div>


            </div >
            <div id="grid"></div>


<script>

    function grid(){
        $("#grid").html("")
        var start=$("#start").val();//开始时间
        var end=$("#end").val();//结束时间
        var  province =$("#province").val();//省
        var  city=$("#city").val();//市
        var  place=$("#place").val();//场地

 if (start=='起始日期'||end=='截至日期'){
     alert("缺少时间条件")
 }else{
      if (place!=''){
         alert('场地方')

          placeGrid();
      }else if(place==''&&city!=''){
          alert('市')

          cityGrid();
      } else{
          alert('省')

          provinceGrid();
      }
 }




console.log(start,end,province,city,place)


    }







//省查询

    //初始化表格数据
    function provinceGrid() {
        kendo.culture("zh-CN");
        var start=$("#start").val();//开始时间
        var end=$("#end").val();//结束时间
        var  province =$("#province").val();//省
        var  city=$("#city").val();//市
        var  place=$("#place").val();//场地
        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: "./fillday?s="+start+"&e="+end+"&id="+province
                },
                parameterMap:function(options, operation){
                    if (operation === "") {

                        var deviceId = options.id;

                        var list = {
                            id:deviceId
                        }
                        return kendo.stringify(list);
                    }

                }
            },
            serverPaging: false,    //设定服务器来实现分页功能
            serverFiltering: true,
            serverSorting: true,
            pageSize: 15,
            schema: {
                model: {
                    id: "id",
                    fields: {
                        id: {type: "number", editable: false},
                        mcSn: {type: "string"},
                        // maintainDateTime: {type: "timestamp"},
                        latitude: {type: "number"},
                        longitude: {type: "number"},
                        mcStatus: {type: "int"},
                        note: {type: "string"},
                        placeEntity:{defaultValue: { id: 1, name: ""}},
                        deviceModelEntity:{defaultValue: { id: 1, name: ""}},
                        supplierEntity:{defaultValue: { id: 1, supplierName: ""}}
                    }
                },
                data: function (response) {
                    return response;
                }
            }
        });


        $("#grid").kendoGrid({
        dataSource: dataSource,
        height: 600,
        sortable: true, //表示是否支持排序， boolean型
        filterable: true,//filterable表示过滤，即能进行等于，不等于，包含，已开头等过滤操作，boolean型

        columnMenu: true,
        pageable: {

        pageSizes: true,

        buttonCount: 5,
        totalPages: true,

        refresh: true,
        pageSize: 5,
        pageSizes: [5, 10, 15, 20],
        numeric: true,
        input: true,
        messages: {
        display: "显示 {0}-{1} 条，共 {2} 条",
        empty: "没有数据",
        itemsPerPage: "每页显示数量",
        first: "第一页",
        last: "最后一页",
        next: "下一页",
        previous: "上一页",
        page: "页",
        of: "共 {0}页"
        }
        },
        columns: [
        {
        field: "site",
        title: "省"
        },

        {
        field: "dm_name",
        title: "按摩椅类型",
        },
        {
        field: "chairType",
        title: "按摩椅型号",
        },
        {
        field: "userNumber",
        title: "用户数"
        },
        {
        field: "payment",
        title: "未付款"
        },
        {
        field: "accountpaid",
        title: "已付款",
        },
        {
        field: "offthestocks",
        title: "已完成",
        },
        {
        field: "canceled",
        title: "已取消",
        },
            {
                field: "orderTotal",
                title: "订单总量",
            },
            {
                field: "income",
                title: "收入总额",
            },
            {
                field: "expend",
                title: "支出总额",
            },
            {
                field: "profit",
                title: "利润",
            },
            {
                field: "unitException",
                title: "异常设备",
            },
        ],
        editable: {
        mode: "popup",
        window: {
        title: "设备管理"
        }
        }
        });}


//------------------------------------------------------------------------------------------------------------
//市查询

    //初始化表格数据
    function cityGrid() {
        kendo.culture("zh-CN");
        var start=$("#start").val();//开始时间
        var end=$("#end").val();//结束时间
        var  province =$("#province").val();//省
        var  city=$("#city").val();//市
        var  place=$("#place").val();//场地
        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: "./fillcity?s="+start+"&e="+end+"&id="+city
                },
                parameterMap:function(options, operation){
                    if (operation === "") {

                        var deviceId = options.id;

                        var list = {
                            id:deviceId
                        }
                        return kendo.stringify(list);
                    }

                }
            },
            serverPaging: false,    //设定服务器来实现分页功能
            serverFiltering: true,
            serverSorting: true,
            pageSize: 15,
            schema: {
                model: {
                    id: "id",
                    fields: {
                        id: {type: "number", editable: false},
                        mcSn: {type: "string"},
                        // maintainDateTime: {type: "timestamp"},
                        latitude: {type: "number"},
                        longitude: {type: "number"},
                        mcStatus: {type: "int"},
                        note: {type: "string"},
                        placeEntity:{defaultValue: { id: 1, name: ""}},
                        deviceModelEntity:{defaultValue: { id: 1, name: ""}},
                        supplierEntity:{defaultValue: { id: 1, supplierName: ""}}
                    }
                },
                data: function (response) {
                    return response;
                }
            }
        });


        $("#grid").kendoGrid({
            dataSource: dataSource,
            height: 600,
            sortable: true, //表示是否支持排序， boolean型
            filterable: true,//filterable表示过滤，即能进行等于，不等于，包含，已开头等过滤操作，boolean型

            columnMenu: true,
            pageable: {

                pageSizes: true,

                buttonCount: 5,
                totalPages: true,

                refresh: true,
                pageSize: 5,
                pageSizes: [5, 10, 15, 20],
                numeric: true,
                input: true,
                messages: {
                    display: "显示 {0}-{1} 条，共 {2} 条",
                    empty: "没有数据",
                    itemsPerPage: "每页显示数量",
                    first: "第一页",
                    last: "最后一页",
                    next: "下一页",
                    previous: "上一页",
                    page: "页",
                    of: "共 {0}页"
                }
            },
            columns: [
                {
                    field: "site",
                    title: "市"
                },

                {
                    field: "dm_name",
                    title: "按摩椅类型",
                },
                {
                    field: "chairType",
                    title: "按摩椅型号",
                },
                {
                    field: "userNumber",
                    title: "用户数"
                },
                {
                    field: "payment",
                    title: "未付款"
                },
                {
                    field: "accountpaid",
                    title: "已付款",
                },
                {
                    field: "offthestocks",
                    title: "已完成",
                },
                {
                    field: "canceled",
                    title: "已取消",
                },
                {
                    field: "orderTotal",
                    title: "订单总量",
                },
                {
                    field: "income",
                    title: "收入总额",
                },
                {
                    field: "expend",
                    title: "支出总额",
                },
                {
                    field: "profit",
                    title: "利润",
                },
                {
                    field: "unitException",
                    title: "异常设备",
                },
            ],
            editable: {
                mode: "popup",
                window: {
                    title: "设备管理"
                }
            }
        });}

//======================================================================================================

// 场地查询

    //初始化表格数据
    function placeGrid() {
        var start=$("#start").val();//开始时间
        var end=$("#end").val();//结束时间
        var  province =$("#province").val();//省
        var  city=$("#city").val();//市
        var  place=$("#place").val();//场地
        kendo.culture("zh-CN");

        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: "./fillplace?s="+start+"&e="+end+"&id="+place
                },
                parameterMap:function(options, operation){
                    if (operation === "") {

                        var deviceId = options.id;

                        var list = {
                            id:deviceId
                        }
                        return kendo.stringify(list);
                    }

                }
            },
            serverPaging: false,    //设定服务器来实现分页功能
            serverFiltering: true,
            serverSorting: true,
            pageSize: 15,
            schema: {
                model: {
                    id: "id",
                    fields: {
                        id: {type: "number", editable: false},
                        mcSn: {type: "string"},
                        // maintainDateTime: {type: "timestamp"},
                        latitude: {type: "number"},
                        longitude: {type: "number"},
                        mcStatus: {type: "int"},
                        note: {type: "string"},
                        placeEntity:{defaultValue: { id: 1, name: ""}},
                        deviceModelEntity:{defaultValue: { id: 1, name: ""}},
                        supplierEntity:{defaultValue: { id: 1, supplierName: ""}}
                    }
                },
                data: function (response) {
                    return response;
                }
            }
        });


        $("#grid").kendoGrid({
            dataSource: dataSource,
            height: 600,
            sortable: true, //表示是否支持排序， boolean型
            filterable: true,//filterable表示过滤，即能进行等于，不等于，包含，已开头等过滤操作，boolean型

            columnMenu: true,
            pageable: {

                pageSizes: true,

                buttonCount: 5,
                totalPages: true,

                refresh: true,
                pageSize: 5,
                pageSizes: [5, 10, 15, 20],
                numeric: true,
                input: true,
                messages: {
                    display: "显示 {0}-{1} 条，共 {2} 条",
                    empty: "没有数据",
                    itemsPerPage: "每页显示数量",
                    first: "第一页",
                    last: "最后一页",
                    next: "下一页",
                    previous: "上一页",
                    page: "页",
                    of: "共 {0}页"
                }
            },
            columns: [
                {
                    field: "site",
                    title: "场地"
                },

                {
                    field: "dm_name",
                    title: "按摩椅类型",
                },
                {
                    field: "chairType",
                    title: "按摩椅型号",
                },
                {
                    field: "userNumber",
                    title: "用户数"
                },
                {
                    field: "payment",
                    title: "未付款"
                },
                {
                    field: "accountpaid",
                    title: "已付款",
                },
                {
                    field: "offthestocks",
                    title: "已完成",
                },
                {
                    field: "canceled",
                    title: "已取消",
                },
                {
                    field: "orderTotal",
                    title: "订单总量",
                },
                {
                    field: "income",
                    title: "收入总额",
                },
                {
                    field: "expend",
                    title: "支出总额",
                },
                {
                    field: "profit",
                    title: "利润",
                },
                {
                    field: "unitException",
                    title: "异常设备",
                },
            ],
            editable: {
                mode: "popup",
                window: {
                    title: "设备管理"
                }
            }
        });}














    $(document).ready(function() {
        function startChange() {
            var startDate = start.value(),
                endDate = end.value();
            if (startDate) {
                startDate = new Date(startDate);
                startDate.setDate(startDate.getDate());
                 startDate=format(startDate,'yyyy-MM-dd');
                end.min(startDate);
                console.log(startDate);
            } else if (endDate) {
                start.max(new Date(endDate));
            } else {
                endDate = new Date();
                start.max(endDate);
                end.min(endDate);
            }
        }

        function endChange() {
            var endDate = end.value(),
                startDate = start.value();

            if (endDate) {
                endDate = new Date(endDate);

                endDate.setDate(endDate.getDate());



                          endDate=format(endDate,'yyyy-MM-dd');








                start.max(endDate);
                console.log(endDate);            //输出2017-10-30
            } else if (startDate) {
                end.min(new Date(startDate));
            } else {
                endDate = new Date();
                start.max(endDate);
                end.min(endDate);
            }

        }
//时间特效
        var start = $("#start").kendoDatePicker({
            change: startChange
        }).data("kendoDatePicker");

        var end = $("#end").kendoDatePicker({
            change: endChange
        }).data("kendoDatePicker");

        start.max(end.value());
        end.min(start.value());


    })


    $(function () {
        $("#province").kendoDropDownList({
            optionLabel: "--请选择省份--",
            dataTextField: "name",
            dataValueField: "id",
            dataSource: {
                transport: {
                    read: {
                        dataType: "json",
                        url: "./province"
                    }
                }
            },
            change: onChange
        });
        $("#city").kendoDropDownList({
            optionLabel: "--请选择城市--"
        });
        $("#place").kendoDropDownList({
            optionLabel: "--请选择场地--"
        });
    });
    function onChange() {
        $("#city").kendoDropDownList({
            optionLabel: "--请选择城市--",
            dataTextField: "name",
            dataValueField: "id",
            dataSource: {
                transport: {
                    read: {
                        dataType: "json",
                        url: "./city1",
                        data: { id: $("#province").data("kendoDropDownList").value() }
                    }
                }
            },
            change: onChange1
        });
        $("#place").kendoDropDownList({
            optionLabel: "--请选择场地--"
        });
    }

    function onChange1() {
        $("#place").kendoDropDownList({
            optionLabel: "--请选择场地--",
            dataTextField: "name",
            dataValueField: "id",
            dataSource: {
                transport: {
                    read: {
                        dataType: "json",
                        url: "./place",
                        data: { id: $("#province").data("kendoDropDownList").value() }
                    }
                }
            }

        });
    }




    function format(time, format) {
        var t = new Date(time);
        var tf = function (i) {
            return (i < 10 ? '0' : '') + i
        };
        return format.replace(/yyyy|MM|dd|HH|mm|ss/g, function (a) {
            switch (a) {
                case 'yyyy':
                    return tf(t.getFullYear());
                    break;
                case 'MM':
                    return tf(t.getMonth() + 1);
                    break;
                case 'mm':
                    return tf(t.getMinutes());
                    break;
                case 'dd':
                    return tf(t.getDate());
                    break;
                case 'HH':
                    return tf(t.getHours());
                    break;
                case 'ss':
                    return tf(t.getSeconds());
                    break;
            }
        })
    }








</script>





    </div>
</div>
<!-- /.container -->
</div>
<footer th:replace="fragments/footer::footer"/>

<aside th:replace="fragments/menu"/>
</body>
</html>