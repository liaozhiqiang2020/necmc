<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header::header-css">
    <meta charset="UTF-8">
    <title>Triangle Platform</title>
    <link rel="stylesheet" href="../static/css/kendo/kendo.common.min.css" />
    <link rel="stylesheet" href="../static/css/kendo/kendo.default.min.css" />
    <link rel="stylesheet" href="../static/css/kendo/kendo.default.mobile.min.css" />
    <!--<script src="http://cdn.kendostatic.com/2013.2.716/js/cultures/kendo.culture.zh-CN.min.js"></script>-->
    <script src="../static/js/jquery-3.2.1.min.js"></script>
    <script src="../static/js/kendo/kendo.all.min.js"></script>
</head>

<body class="hold-transition skin-blue sidebar-mini">
<div th:replace="fragments/header :: header-body"/>
<div class="content-wrapper">
    <section th:replace="fragments/sitemap"/>
    <div class="container-fluid">
        <div id="example">
            <style>
                .k-multicheck-wrap {
                    overflow-x: hidden;
                }
            </style>
            <div class="demo-section k-content wide">
                <div id="client"></div>
            </div>

            <script id="product-template" type="text/x-kendo-template">
                <h4> #: user.name #</h4>
            </script>

            <script>
                $(document).ready(function() {

                    $("#client").kendoGrid({
                        dataSource: {
                            transport: {
                                read:  {
                                    url: "./price/status",
                                    dataType: "json"
                                },
                                update: {
                                    type: "post",
                                    url: "./price/update",
                                    dataType: "json",
                                    contentType : "application/json"

                                },
                                destroy: {
                                    url: "./price/batchDelete",
                                    dataType: "json",
                                    type: "post",
                                    contentType : "application/json"
                                },
                                create: {
                                    url: "./price/update",
                                    dataType: "json",
                                    type: "post",
                                    contentType : "application/json"
                                },
                                parameterMap: function(options, operation) {
                                    // for(let i = 0; i<options.models;i++){
                                    //     let a = options.models;
                                    //     a[i].startDateTime
                                    // }

                                    if (operation !== "read" && options.models) {
                                        return  kendo.stringify(options.models);
                                    }
                                }
                            },
                            batch: true,
                            pageSize: 20,
                            schema: {
                                model: {
                                    id: "id",
                                    fields: {
                                        id: { editable: false, nullable: true },
                                        price: { type: "number", validation: { required: true, min: 1} },
                                        useTime: { type: "number" ,validation: { required: true, min: 1} },
                                        createDateTime: { type: "timestamp",editable: false , format: "{0:yyyy-MM-dd HH:mm:ss}"},
                                        startDateTime: { type: "timestamp", format: "{0:yyyy-MM-dd HH:mm:ss}" },
                                        endDateTime: { type: "timestamp", format: "{0:yyyy-MM-dd HH:mm:ss}" },
                                        userId: { type: "int" ,editable: false},
                                        status: { type: "number",editable: false },
                                        priceName : {type : "string"},
                                        user :{type:"array",editable: false},
                                        deviceModelEntity : {type:"array",editable: false},
                                    }
                                }
                            }
                        },
                        filterable: true,
                        pageable: {
                            refresh: true,
                            // pageSizes: true,
                            pageSize: 5,
                            totalPages: true,
                            pageSizes: [5, 10, 15, 20],
                            buttonCount: 5,
                        },
                        height: 550,
                        toolbar: ["create", "save", "cancel"],
                        columns: [
                            {field: "rowNumber", title: "序号", width: 80,template: "<span class='row-number'></span>"},
                            { field: "priceName",title: "价格名称", width: 100,filterable: { multi: true, search: true} },
                            { field: "price", title: "价格(元)", width: 80, filterable: { multi: true,search: true } },
                            { field: "useTime", title: "时长(分钟)", width: 80, filterable: { multi: true } },
                            { field: "user.name", title: "创建人", width: 100, filterable: { multi: true },template:"<span class='product-preview'></span>" },
                            { field: "createDateTime",title: "创建时间",width: 120, filterable: { multi: true, search: true}, format: "{0:yyyy-MM-dd HH:mm:ss}" },
                            { field: "startDateTime",title: "开始时间",width: 120, filterable: { multi: true, search: true}, format: "{0:yyyy-MM-dd HH:mm:ss}",
                                editor: changeDate },
                            { field: "endDateTime",title: "结束时间",width: 120, filterable: { multi: true, search: true}, format: "{0:yyyy-MM-dd HH:mm:ss}",
                                editor: changeDate },
                            { field: "status",title: "状态",width: 80, filterable: { multi: true, search: true}, values: [
                                    { text: "false", value: 0 },
                                    { text: "true", value: 1 }] },
                            { field: "deviceModelEntity.name", title: "按摩椅类型", width: 100, filterable: { multi: true } },
                            // { field: "status", title: "状态",width: 120, filterable: { multi: true, dataSource: [{ Discontinued: 1 }, { Discontinued: 0 }]} },
                            { command: "destroy", title: "&nbsp;", width: 100}],

                        editable: true,
                        dataBound: function () {
                            var rows = this.items();
                            var page = this.pager.page() - 1;
                            var pagesize = this.pager.pageSize();
                            $(rows).each(function () {
                                var index = $(this).index() + 1 + page * pagesize;
                                var rowLabel = $(this).find(".row-number");
                                $(rowLabel).html(index);
                            });
                        }
                    });
                    var template = kendo.template($("#product-template").html());
                    function changeDate(container, options) {
                        var input = $('<input name="' + options.field + '"/>');
                        input.appendTo(container);
                        input.kendoDateTimePicker({
                            format: "{0:yyyy-MM-dd HH:mm}"
                        });
                    }


                });
            </script>
        </div>
    </div>
</div>
<footer th:replace="fragments/footer::footer"/>
<aside th:replace="fragments/menu"/>

</body>
</html>